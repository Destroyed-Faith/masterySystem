/* =========================================
   Destroyed Faith / Rulebook Chat Theme
   Applies when body has .ms-theme-rulebook
   ========================================= */

.ms-theme-rulebook #chat-log,
.ms-theme-rulebook #chat-form,
.ms-theme-rulebook #chat-controls {
  font-family: var(--ms-font-body);
  color: var(--ms-text);
}

/* --- Base chat message container --- */
.ms-theme-rulebook #chat-log .chat-message {
  background: var(--ms-panel);
  color: var(--ms-text);
  border: 1px solid var(--ms-border);
  border-radius: var(--ms-radius);
  box-shadow: 0 2px 10px var(--ms-shadow);
  overflow: hidden;
}

.ms-theme-rulebook #chat-log .chat-message + .chat-message {
  margin-top: 6px;
}

.ms-theme-rulebook #chat-log .chat-message .message-header {
  background: var(--ms-panel2);
  border-bottom: 1px solid var(--ms-border);
  padding: 6px 8px;
}

.ms-theme-rulebook #chat-log .chat-message .message-header .message-sender {
  font-family: var(--ms-font-head);
  color: var(--ms-muted);
  letter-spacing: 0.6px;
  text-transform: uppercase;
  font-size: 12px;
}

.ms-theme-rulebook #chat-log .chat-message .message-header .message-metadata {
  color: var(--ms-muted);
  font-size: 11px;
  opacity: 0.7;
}

.ms-theme-rulebook #chat-log .chat-message .message-content {
  padding: 8px;
}

/* Links */
.ms-theme-rulebook #chat-log .chat-message a {
  color: var(--ms-accent);
  text-decoration: none;
}
.ms-theme-rulebook #chat-log .chat-message a:hover {
  color: var(--ms-accent);
  text-decoration: underline;
  text-decoration-color: var(--ms-accent2);
}

/* Inline rolls */
.ms-theme-rulebook #chat-log .inline-roll,
.ms-theme-rulebook #chat-log .inline-roll .dice-total {
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--ms-border);
  color: var(--ms-text);
  border-radius: 6px;
}

/* --- Dice roll block --- */
.ms-theme-rulebook #chat-log .dice-roll {
  background: rgba(0,0,0,0.18);
  border: 1px solid var(--ms-border);
  border-radius: 10px;
  padding: 8px;
}

.ms-theme-rulebook #chat-log .dice-roll .dice-formula {
  background: transparent;
  border: 0;
  color: var(--ms-muted);
  font-size: 12px;
  margin-bottom: 6px;
}

.ms-theme-rulebook #chat-log .dice-roll .dice-tooltip {
  background: rgba(0,0,0,0.25);
  border: 1px solid var(--ms-border);
  border-radius: 10px;
}

.ms-theme-rulebook #chat-log .dice-roll .dice-total {
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--ms-border);
  border-radius: 10px;
  color: var(--ms-muted);
  font-family: var(--ms-font-head);
  letter-spacing: 0.6px;
  text-transform: uppercase;
  padding: 6px 8px;
}

/* Subtle crit/fumble (Foundry adds these classes in some contexts) */
.ms-theme-rulebook #chat-log .dice-total.critical {
  border-color: rgba(202, 178, 113, 0.55);
  box-shadow: 0 0 0 1px rgba(202, 178, 113, 0.25) inset;
}
.ms-theme-rulebook #chat-log .dice-total.fumble {
  border-color: rgba(156, 78, 78, 0.55);
  box-shadow: 0 0 0 1px rgba(156, 78, 78, 0.25) inset;
}

/* --- Mastery Roll Card --- */
.ms-theme-rulebook #chat-log .mastery-roll {
  background: transparent;
  border: 1px solid var(--ms-border);
  border-radius: 12px;
  padding: 8px;
}

.ms-theme-rulebook #chat-log .mastery-roll .roll-header {
  background: rgba(0,0,0,0.18);
  border-bottom: 1px solid var(--ms-border);
  padding: 8px;
  margin-bottom: 8px;
}

.ms-theme-rulebook #chat-log .mastery-roll .roll-header h3 {
  font-family: var(--ms-font-head);
  color: var(--ms-muted);
  letter-spacing: 0.8px;
  text-transform: uppercase;
  font-size: 13px;
  margin: 0;
}

.ms-theme-rulebook #chat-log .mastery-roll .roll-header .flavor {
  color: var(--ms-muted);
  font-size: 11px;
  opacity: 0.7;
  margin-top: 4px;
}

.ms-theme-rulebook #chat-log .mastery-roll .roll-breakdown {
  background: rgba(0,0,0,0.12);
  border: 1px solid var(--ms-border);
  border-radius: 8px;
  padding: 8px;
  margin-bottom: 8px;
}

.ms-theme-rulebook #chat-log .mastery-roll .breakdown-line {
  color: var(--ms-text);
  border-bottom: 1px dashed rgba(255,255,255,0.08);
}

.ms-theme-rulebook #chat-log .mastery-roll .breakdown-line.total {
  border-top: 1px solid var(--ms-border);
  border-bottom: 0;
  color: var(--ms-muted);
  font-family: var(--ms-font-head);
}

.ms-theme-rulebook #chat-log .mastery-roll .breakdown-line .value {
  color: var(--ms-muted);
  font-weight: 600;
}

.ms-theme-rulebook #chat-log .mastery-roll .roll-result {
  background: rgba(0,0,0,0.12);
  border: 1px solid var(--ms-border);
  border-radius: 8px;
  padding: 8px;
}

.ms-theme-rulebook #chat-log .mastery-roll .roll-result.success {
  border-color: rgba(63, 107, 84, 0.4);
}

.ms-theme-rulebook #chat-log .mastery-roll .roll-result.failure {
  border-color: rgba(123, 58, 58, 0.4);
}

.ms-theme-rulebook #chat-log .mastery-roll .result-line .value {
  color: var(--ms-muted);
  font-weight: 600;
}

/* --- Mastery Attack Card --- */
.ms-theme-rulebook #chat-log .mastery-attack-card,
.ms-theme-rulebook #chat-log .mastery-system-attack-card {
  background: transparent;
  border: 1px solid var(--ms-border);
  border-radius: 12px;
  overflow: hidden;
  padding: 0;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .attack-header {
  background: rgba(0,0,0,0.18);
  border-bottom: 1px solid var(--ms-border);
  padding: 8px;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .attack-header h3 {
  font-family: var(--ms-font-head);
  color: var(--ms-muted);
  letter-spacing: 0.8px;
  text-transform: uppercase;
  font-size: 13px;
  margin: 0 0 4px 0;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .attack-header h3 i {
  color: var(--ms-muted);
}

.ms-theme-rulebook #chat-log .mastery-attack-card .attack-participants {
  color: var(--ms-muted);
  font-size: 11px;
  opacity: 0.8;
  margin-top: 2px;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .attack-details {
  background: transparent;
  border: 0;
  padding: 8px;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .detail-row {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  padding: 5px 0;
  border-bottom: 1px dashed rgba(255,255,255,0.08);
}

.ms-theme-rulebook #chat-log .mastery-attack-card .detail-row:last-child {
  border-bottom: 0;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .detail-row span:first-child,
.ms-theme-rulebook #chat-log .mastery-attack-card .detail-label {
  color: var(--ms-muted);
  font-size: 12px;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .detail-row span:last-child,
.ms-theme-rulebook #chat-log .mastery-attack-card .detail-value {
  color: var(--ms-text);
  font-weight: 600;
  font-size: 12px;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .attack-controls {
  padding: 8px;
  background: rgba(0,0,0,0.12);
  border-top: 1px solid var(--ms-border);
}

/* --- Mastery Damage Cards / Blocks --- */
.ms-theme-rulebook #chat-log .mastery-damage-card,
.ms-theme-rulebook #chat-log .mastery-system-damage {
  background: transparent;
  border: 1px solid var(--ms-border);
  border-radius: 12px;
  padding: 8px;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .damage-header,
.ms-theme-rulebook #chat-log .mastery-system-damage h3,
.ms-theme-rulebook #chat-log .mastery-system-damage h4 {
  font-family: var(--ms-font-head);
  color: var(--ms-muted);
  letter-spacing: 0.8px;
  text-transform: uppercase;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding-bottom: 6px;
  margin: 0 0 8px 0;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .damage-header h3 i,
.ms-theme-rulebook #chat-log .mastery-system-damage h3 i {
  color: var(--ms-muted);
}

.ms-theme-rulebook #chat-log .mastery-damage-card .damage-participants {
  color: var(--ms-muted);
  font-size: 11px;
  opacity: 0.8;
  margin-top: 4px;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .damage-details {
  background: transparent;
  border: 0;
  padding: 0;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .damage-row,
.ms-theme-rulebook #chat-log .mastery-system-damage .damage-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 4px 0;
  border-bottom: 1px dashed rgba(255,255,255,0.08);
}

.ms-theme-rulebook #chat-log .mastery-damage-card .damage-row:last-child,
.ms-theme-rulebook #chat-log .mastery-system-damage .damage-row:last-child {
  border-bottom: 0;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .damage-label,
.ms-theme-rulebook #chat-log .mastery-damage-card .damage-type,
.ms-theme-rulebook #chat-log .mastery-system-damage .damage-type {
  color: var(--ms-muted);
  text-transform: uppercase;
  letter-spacing: 0.6px;
  font-size: 11px;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .damage-value,
.ms-theme-rulebook #chat-log .mastery-damage-card .damage-amount,
.ms-theme-rulebook #chat-log .mastery-system-damage .damage-amount {
  color: var(--ms-muted);
  font-family: var(--ms-font-head);
  letter-spacing: 0.6px;
  font-weight: 600;
}

.ms-theme-rulebook #chat-log .mastery-system-damage p {
  color: var(--ms-text);
  font-size: 13px;
  line-height: 1.6;
}

.ms-theme-rulebook #chat-log .mastery-system-damage p:first-of-type {
  background: rgba(0,0,0,0.12);
  border: 1px solid var(--ms-border);
  border-radius: 6px;
  padding: 8px;
  margin: 8px 0;
}

.ms-theme-rulebook #chat-log .mastery-system-damage p strong {
  color: var(--ms-muted);
  font-weight: 600;
}

.ms-theme-rulebook #chat-log .mastery-system-damage p:last-child {
  border-top: 1px dashed rgba(255,255,255,0.08);
  padding-top: 8px;
  margin-top: 8px;
  color: var(--ms-muted);
  font-size: 12px;
}

/* --- Mastery Action / Info Messages --- */
.ms-theme-rulebook #chat-log .mastery-system-action,
.ms-theme-rulebook #chat-log .mastery-system-info {
  background: transparent;
  border: 1px solid var(--ms-border);
  border-radius: 12px;
  padding: 8px;
}

.ms-theme-rulebook #chat-log .mastery-system-action h3,
.ms-theme-rulebook #chat-log .mastery-system-info h3 {
  font-family: var(--ms-font-head);
  color: var(--ms-muted);
  letter-spacing: 0.8px;
  text-transform: uppercase;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding-bottom: 6px;
  margin: 0 0 8px 0;
  font-size: 13px;
}

.ms-theme-rulebook #chat-log .mastery-system-action h3 i,
.ms-theme-rulebook #chat-log .mastery-system-info h3 i {
  color: var(--ms-muted);
}

.ms-theme-rulebook #chat-log .mastery-system-action p,
.ms-theme-rulebook #chat-log .mastery-system-info p {
  color: var(--ms-text);
  font-size: 13px;
  line-height: 1.6;
}

.ms-theme-rulebook #chat-log .mastery-system-action p {
  background: rgba(0,0,0,0.12);
  border: 1px solid var(--ms-border);
  border-radius: 6px;
  padding: 8px;
}

.ms-theme-rulebook #chat-log .mastery-system-info .info-details {
  background: rgba(0,0,0,0.12);
  border: 1px solid var(--ms-border);
  border-radius: 6px;
  padding: 8px;
  margin: 8px 0;
}

.ms-theme-rulebook #chat-log .mastery-system-info .info-row {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  border-bottom: 1px dashed rgba(255,255,255,0.08);
}

.ms-theme-rulebook #chat-log .mastery-system-info .info-row:last-child {
  border-bottom: 0;
}

.ms-theme-rulebook #chat-log .mastery-system-info .info-label {
  color: var(--ms-muted);
  font-size: 12px;
}

.ms-theme-rulebook #chat-log .mastery-system-info .info-value {
  color: var(--ms-text);
  font-weight: 600;
  font-size: 12px;
}

/* --- Controls: selects, inputs --- */
.ms-theme-rulebook #chat-log select,
.ms-theme-rulebook #chat-log input[type="number"],
.ms-theme-rulebook #chat-log input[type="text"],
.ms-theme-rulebook #chat-log .raises-select,
.ms-theme-rulebook #chat-log .raises-input,
.ms-theme-rulebook #chat-log .power-select {
  background: rgba(0,0,0,0.25);
  color: var(--ms-text);
  border: 1px solid var(--ms-border);
  border-radius: 8px;
  padding: 4px 6px;
  font-family: var(--ms-font-body);
  font-size: 12px;
}

.ms-theme-rulebook #chat-log select:focus,
.ms-theme-rulebook #chat-log input:focus,
.ms-theme-rulebook #chat-log .raises-select:focus,
.ms-theme-rulebook #chat-log .raises-input:focus,
.ms-theme-rulebook #chat-log .power-select:focus {
  outline: none;
  border-color: var(--ms-accent);
  box-shadow: 0 0 4px var(--ms-accent2);
}

.ms-theme-rulebook #chat-log select:hover,
.ms-theme-rulebook #chat-log input:hover,
.ms-theme-rulebook #chat-log .raises-select:hover,
.ms-theme-rulebook #chat-log .raises-input:hover,
.ms-theme-rulebook #chat-log .power-select:hover {
  border-color: var(--ms-accent);
}

.ms-theme-rulebook #chat-log .raises-input-group label {
  color: var(--ms-muted);
  font-family: var(--ms-font-head);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.6px;
}

/* --- Buttons (attack, damage, apply etc.) --- */
.ms-theme-rulebook #chat-log button,
.ms-theme-rulebook #chat-log .roll-attack-btn,
.ms-theme-rulebook #chat-log .roll-damage-btn,
.ms-theme-rulebook #chat-log .apply-damage-btn,
.ms-theme-rulebook #chat-log .apply-specials-btn,
.ms-theme-rulebook #chat-log .apply-button,
.ms-theme-rulebook #chat-log .cancel-damage-btn {
  background: rgba(255,255,255,0.06);
  color: var(--ms-text);
  border: 1px solid var(--ms-border);
  border-radius: 8px;
  padding: 6px 10px;
  font-family: var(--ms-font-head);
  letter-spacing: 0.6px;
  text-transform: uppercase;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.ms-theme-rulebook #chat-log button:hover,
.ms-theme-rulebook #chat-log .roll-attack-btn:hover,
.ms-theme-rulebook #chat-log .roll-damage-btn:hover,
.ms-theme-rulebook #chat-log .apply-damage-btn:hover,
.ms-theme-rulebook #chat-log .apply-specials-btn:hover,
.ms-theme-rulebook #chat-log .apply-button:hover {
  border-color: rgba(202, 178, 113, 0.55);
  box-shadow: 0 0 0 1px rgba(202, 178, 113, 0.18) inset;
  color: var(--ms-muted);
}

.ms-theme-rulebook #chat-log button:active,
.ms-theme-rulebook #chat-log .roll-attack-btn:active,
.ms-theme-rulebook #chat-log .roll-damage-btn:active {
  transform: translateY(1px);
  box-shadow: 0 1px 2px rgba(0,0,0,0.3) inset;
}

.ms-theme-rulebook #chat-log button:disabled,
.ms-theme-rulebook #chat-log .roll-attack-btn:disabled,
.ms-theme-rulebook #chat-log .roll-damage-btn:disabled,
.ms-theme-rulebook #chat-log .apply-damage-btn:disabled,
.ms-theme-rulebook #chat-log .apply-specials-btn:disabled,
.ms-theme-rulebook #chat-log .apply-button:disabled {
  opacity: 0.45;
  cursor: not-allowed;
}

.ms-theme-rulebook #chat-log .roll-attack-btn.rolled,
.ms-theme-rulebook #chat-log .roll-damage-btn.rolled {
  border-color: rgba(63, 107, 84, 0.4);
  background: rgba(63, 107, 84, 0.1);
}

.ms-theme-rulebook #chat-log .roll-attack-btn.rolled:hover,
.ms-theme-rulebook #chat-log .roll-damage-btn.rolled:hover {
  border-color: rgba(63, 107, 84, 0.5);
  box-shadow: 0 0 0 1px rgba(63, 107, 84, 0.2) inset;
}

/* Optional: emphasize "danger" actions subtly, not bright red */
.ms-theme-rulebook #chat-log .apply-damage-btn,
.ms-theme-rulebook #chat-log .cancel-damage-btn {
  border-color: rgba(156, 78, 78, 0.35);
}

.ms-theme-rulebook #chat-log .apply-damage-btn:hover,
.ms-theme-rulebook #chat-log .cancel-damage-btn:hover {
  border-color: rgba(156, 78, 78, 0.60);
  box-shadow: 0 0 0 1px rgba(156, 78, 78, 0.18) inset;
}

/* --- Raises section styling --- */
.ms-theme-rulebook #chat-log .mastery-damage-card .raises-section,
.ms-theme-rulebook #chat-log .mastery-attack-card .raises-section {
  background: rgba(0,0,0,0.12);
  border: 1px solid var(--ms-border);
  border-radius: 8px;
  padding: 8px;
  margin-bottom: 8px;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .raises-section h4 {
  font-family: var(--ms-font-head);
  color: var(--ms-muted);
  letter-spacing: 0.6px;
  text-transform: uppercase;
  font-size: 11px;
  margin: 0 0 6px 0;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .raises-description {
  color: var(--ms-muted);
  font-size: 11px;
  opacity: 0.7;
  margin-bottom: 8px;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .raise-item {
  background: rgba(0,0,0,0.12);
  border: 1px solid var(--ms-border);
  border-radius: 6px;
  padding: 6px;
}

.ms-theme-rulebook #chat-log .mastery-damage-card .raise-item label {
  color: var(--ms-muted);
  font-family: var(--ms-font-head);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* --- Power selection section --- */
.ms-theme-rulebook #chat-log .mastery-attack-card .power-selection-section {
  background: rgba(0,0,0,0.12);
  border: 1px solid var(--ms-border);
  border-radius: 8px;
  padding: 8px;
  margin-bottom: 8px;
}

.ms-theme-rulebook #chat-log .mastery-attack-card .power-selection-section label span:first-child {
  color: var(--ms-muted);
  font-family: var(--ms-font-head);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* --- Damage actions section --- */
.ms-theme-rulebook #chat-log .mastery-damage-card .damage-actions {
  padding: 8px;
  background: rgba(0,0,0,0.12);
  border-top: 1px solid var(--ms-border);
  margin-top: 8px;
}

/* --- Dice pool styling for mastery rolls --- */
.ms-theme-rulebook #chat-log .mastery-roll .dice-pool {
  margin-bottom: 8px;
}

.ms-theme-rulebook #chat-log .mastery-roll .dice-pool .label {
  color: var(--ms-muted);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: var(--ms-font-head);
}

.ms-theme-rulebook #chat-log .mastery-roll .die {
  background: rgba(0,0,0,0.25);
  border: 1px solid var(--ms-border);
  color: var(--ms-text);
}

.ms-theme-rulebook #chat-log .mastery-roll .die.kept {
  background: rgba(63, 107, 84, 0.2);
  border-color: rgba(63, 107, 84, 0.4);
  box-shadow: 0 0 4px rgba(63, 107, 84, 0.3);
}

.ms-theme-rulebook #chat-log .mastery-roll .die.exploded {
  background: rgba(202, 178, 113, 0.2);
  border-color: rgba(202, 178, 113, 0.4);
  box-shadow: 0 0 4px rgba(202, 178, 113, 0.3);
}

.ms-theme-rulebook #chat-log .mastery-roll .die.kept.exploded {
  background: linear-gradient(135deg, rgba(63, 107, 84, 0.2) 50%, rgba(202, 178, 113, 0.2) 50%);
  border-color: rgba(202, 178, 113, 0.4);
}
