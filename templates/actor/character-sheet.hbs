<form class="{{cssClass}}" autocomplete="off">
  
  <!-- Header -->
  <header class="sheet-header">
    <div class="header-left">
      <img class="profile-img {{#if editable}}{{else}}locked{{/if}}" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" alt="{{actor.name}}" />
      <div class="header-fields">
        <h1 class="charname">
          {{#if editable}}
            <input name="name" type="text" value="{{actor.name}}" placeholder="Character Name" />
          {{else}}
            <span>{{actor.name}}</span>
          {{/if}}
        </h1>
        <div class="mastery-rank-display">
          <label>Mastery Rank:</label>
          {{#if editable}}
            <input type="number" name="system.mastery.rank" value="{{default system.mastery.rank 2}}" min="1" max="10" />
          {{else}}
            <span class="value">{{default system.mastery.rank 2}}</span>
          {{/if}}
        </div>
      </div>
    </div>
    <div class="header-right">
      {{#if owner}}
        <button type="button" class="edit-mode-toggle" title="Toggle Edit Mode">
          <i class="fas fa-edit"></i> {{#if editable}}View{{else}}Edit{{/if}}
        </button>
      {{/if}}
    </div>
  </header>

  <!-- Tabs Navigation (Right Side Bookmarks) -->
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="attributes"><i class="fas fa-fist-raised"></i> Attributes</a>
    <a class="item" data-tab="skills"><i class="fas fa-cogs"></i> Skills</a>
    <a class="item" data-tab="powers"><i class="fas fa-magic"></i> Powers</a>
    <a class="item" data-tab="equipment"><i class="fas fa-shield-alt"></i> Equipment</a>
    <a class="item" data-tab="magic"><i class="fas fa-hat-wizard"></i> Magic</a>
    <a class="item" data-tab="biography"><i class="fas fa-scroll"></i> Bio</a>
  </nav>

  <!-- Sheet Body -->
  <section class="sheet-body">
    
    <!-- ATTRIBUTES TAB -->
    <div class="tab attributes" data-group="primary" data-tab="attributes">
      
      <!-- Attributes Grid Section -->
      <div class="attributes-grid-section">
        <h3><i class="fas fa-fist-raised"></i> Character Attributes</h3>
        
        <!-- Row 1: Physical + Mental Attributes -->
        <div class="attributes-grid">
          
          <!-- Might -->
          {{#with system.attributes.might}}
            <div class="attribute-card" data-attribute="might">
              <div class="attribute-card-header">
                <h4 class="attribute-name"><i class="fas fa-dumbbell"></i> Might</h4>
                <div class="attribute-value">{{default value 0}}</div>
              </div>
              
              <!-- Stones Display -->
              <div class="attribute-stones">
                <div class="stones-container">
                  {{#times (calculateStones value)}}
                    <span class="stone filled">⬤</span>
                  {{/times}}
                  {{#times (subtract 5 (calculateStones value))}}
                    <span class="stone empty">○</span>
                  {{/times}}
                </div>
                <div class="stones-count">{{calculateStones value}} / 5 Stones</div>
              </div>
              
              <!-- Controls -->
              {{#if ../../editable}}
                <div class="attribute-controls">
                  <button type="button" class="attribute-adjust" data-attribute="might" data-adjustment="-1" title="Decrease">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" name="system.attributes.might.value" value="{{default value 0}}" min="0" max="40" data-dtype="Number" />
                  <button type="button" class="attribute-adjust" data-attribute="might" data-adjustment="1" title="Increase">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              {{else}}
                <div class="attribute-value-static">{{default value 0}}</div>
              {{/if}}
              
              <!-- Roll Button -->
              <button type="button" class="attribute-roll" data-attribute="might" title="Roll Might">
                <i class="fas fa-dice-d20"></i> Roll Might
              </button>
            </div>
          {{/with}}
          
          <!-- Agility -->
          {{#with system.attributes.agility}}
            <div class="attribute-card" data-attribute="agility">
              <div class="attribute-card-header">
                <h4 class="attribute-name"><i class="fas fa-running"></i> Agility</h4>
                <div class="attribute-value">{{default value 0}}</div>
              </div>
              
              <div class="attribute-stones">
                <div class="stones-container">
                  {{#times (calculateStones value)}}
                    <span class="stone filled">⬤</span>
                  {{/times}}
                  {{#times (subtract 5 (calculateStones value))}}
                    <span class="stone empty">○</span>
                  {{/times}}
                </div>
                <div class="stones-count">{{calculateStones value}} / 5 Stones</div>
              </div>
              
              {{#if ../../editable}}
                <div class="attribute-controls">
                  <button type="button" class="attribute-adjust" data-attribute="agility" data-adjustment="-1">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" name="system.attributes.agility.value" value="{{default value 0}}" min="0" max="40" data-dtype="Number" />
                  <button type="button" class="attribute-adjust" data-attribute="agility" data-adjustment="1">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              {{/if}}
              
              <button type="button" class="attribute-roll" data-attribute="agility">
                <i class="fas fa-dice-d20"></i> Roll Agility
              </button>
            </div>
          {{/with}}
          
          <!-- Vitality -->
          {{#with system.attributes.vitality}}
            <div class="attribute-card" data-attribute="vitality">
              <div class="attribute-card-header">
                <h4 class="attribute-name"><i class="fas fa-heart"></i> Vitality</h4>
                <div class="attribute-value">{{default value 0}}</div>
              </div>
              
              <div class="attribute-stones">
                <div class="stones-container">
                  {{#times (calculateStones value)}}
                    <span class="stone filled">⬤</span>
                  {{/times}}
                  {{#times (subtract 5 (calculateStones value))}}
                    <span class="stone empty">○</span>
                  {{/times}}
                </div>
                <div class="stones-count">{{calculateStones value}} / 5 Stones</div>
              </div>
              
              {{#if ../../editable}}
                <div class="attribute-controls">
                  <button type="button" class="attribute-adjust" data-attribute="vitality" data-adjustment="-1">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" name="system.attributes.vitality.value" value="{{default value 0}}" min="0" max="40" data-dtype="Number" />
                  <button type="button" class="attribute-adjust" data-attribute="vitality" data-adjustment="1">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              {{/if}}
              
              <button type="button" class="attribute-roll" data-attribute="vitality">
                <i class="fas fa-dice-d20"></i> Roll Vitality
              </button>
            </div>
          {{/with}}
          
          <!-- Wits -->
          {{#with system.attributes.wits}}
            <div class="attribute-card" data-attribute="wits">
              <div class="attribute-card-header">
                <h4 class="attribute-name"><i class="fas fa-brain"></i> Wits</h4>
                <div class="attribute-value">{{default value 0}}</div>
              </div>
              
              <div class="attribute-stones">
                <div class="stones-container">
                  {{#times (calculateStones value)}}
                    <span class="stone filled">⬤</span>
                  {{/times}}
                  {{#times (subtract 5 (calculateStones value))}}
                    <span class="stone empty">○</span>
                  {{/times}}
                </div>
                <div class="stones-count">{{calculateStones value}} / 5 Stones</div>
              </div>
              
              {{#if ../../editable}}
                <div class="attribute-controls">
                  <button type="button" class="attribute-adjust" data-attribute="wits" data-adjustment="-1">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" name="system.attributes.wits.value" value="{{default value 0}}" min="0" max="40" data-dtype="Number" />
                  <button type="button" class="attribute-adjust" data-attribute="wits" data-adjustment="1">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              {{/if}}
              
              <button type="button" class="attribute-roll" data-attribute="wits">
                <i class="fas fa-dice-d20"></i> Roll Wits
              </button>
            </div>
          {{/with}}
          
        </div>
        
        <!-- Row 2: Mental/Social Attributes -->
        <div class="attributes-grid">
          
          <!-- Intellect -->
          {{#with system.attributes.intellect}}
            <div class="attribute-card" data-attribute="intellect">
              <div class="attribute-card-header">
                <h4 class="attribute-name"><i class="fas fa-book"></i> Intellect</h4>
                <div class="attribute-value">{{default value 0}}</div>
              </div>
              
              <div class="attribute-stones">
                <div class="stones-container">
                  {{#times (calculateStones value)}}
                    <span class="stone filled">⬤</span>
                  {{/times}}
                  {{#times (subtract 5 (calculateStones value))}}
                    <span class="stone empty">○</span>
                  {{/times}}
                </div>
                <div class="stones-count">{{calculateStones value}} / 5 Stones</div>
              </div>
              
              {{#if ../../editable}}
                <div class="attribute-controls">
                  <button type="button" class="attribute-adjust" data-attribute="intellect" data-adjustment="-1">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" name="system.attributes.intellect.value" value="{{default value 0}}" min="0" max="40" data-dtype="Number" />
                  <button type="button" class="attribute-adjust" data-attribute="intellect" data-adjustment="1">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              {{/if}}
              
              <button type="button" class="attribute-roll" data-attribute="intellect">
                <i class="fas fa-dice-d20"></i> Roll Intellect
              </button>
            </div>
          {{/with}}
          
          <!-- Resolve -->
          {{#with system.attributes.resolve}}
            <div class="attribute-card" data-attribute="resolve">
              <div class="attribute-card-header">
                <h4 class="attribute-name"><i class="fas fa-mountain"></i> Resolve</h4>
                <div class="attribute-value">{{default value 0}}</div>
              </div>
              
              <div class="attribute-stones">
                <div class="stones-container">
                  {{#times (calculateStones value)}}
                    <span class="stone filled">⬤</span>
                  {{/times}}
                  {{#times (subtract 5 (calculateStones value))}}
                    <span class="stone empty">○</span>
                  {{/times}}
                </div>
                <div class="stones-count">{{calculateStones value}} / 5 Stones</div>
              </div>
              
              {{#if ../../editable}}
                <div class="attribute-controls">
                  <button type="button" class="attribute-adjust" data-attribute="resolve" data-adjustment="-1">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" name="system.attributes.resolve.value" value="{{default value 0}}" min="0" max="40" data-dtype="Number" />
                  <button type="button" class="attribute-adjust" data-attribute="resolve" data-adjustment="1">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              {{/if}}
              
              <button type="button" class="attribute-roll" data-attribute="resolve">
                <i class="fas fa-dice-d20"></i> Roll Resolve
              </button>
            </div>
          {{/with}}
          
          <!-- Influence -->
          {{#with system.attributes.influence}}
            <div class="attribute-card" data-attribute="influence">
              <div class="attribute-card-header">
                <h4 class="attribute-name"><i class="fas fa-users"></i> Influence</h4>
                <div class="attribute-value">{{default value 0}}</div>
              </div>
              
              <div class="attribute-stones">
                <div class="stones-container">
                  {{#times (calculateStones value)}}
                    <span class="stone filled">⬤</span>
                  {{/times}}
                  {{#times (subtract 5 (calculateStones value))}}
                    <span class="stone empty">○</span>
                  {{/times}}
                </div>
                <div class="stones-count">{{calculateStones value}} / 5 Stones</div>
              </div>
              
              {{#if ../../editable}}
                <div class="attribute-controls">
                  <button type="button" class="attribute-adjust" data-attribute="influence" data-adjustment="-1">
                    <i class="fas fa-minus"></i>
                  </button>
                  <input type="number" name="system.attributes.influence.value" value="{{default value 0}}" min="0" max="40" data-dtype="Number" />
                  <button type="button" class="attribute-adjust" data-attribute="influence" data-adjustment="1">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              {{/if}}
              
              <button type="button" class="attribute-roll" data-attribute="influence">
                <i class="fas fa-dice-d20"></i> Roll Influence
              </button>
            </div>
          {{/with}}
          
        </div>
        
        <!-- Total Stones Summary -->
        <div class="stones-summary">
          <div class="stones-summary-content">
            <div class="stones-summary-item">
              <h4><i class="fas fa-gem"></i> Total Stones</h4>
              <div class="stones-total">
                <span class="current">{{default resources.stones.current 0}}</span> / 
                <span class="maximum">{{default resources.stones.maximum 0}}</span>
              </div>
            </div>
            <div class="stones-summary-item">
              <h4><i class="fas fa-sync-alt"></i> Regeneration</h4>
              <div class="stones-regen">
                {{default resources.stones.regeneration 2}} per round
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Combat Stats Section -->
      <div class="combat-stats-section">
        <h3><i class="fas fa-shield-alt"></i> Combat Statistics</h3>
        
        <div class="combat-stats-grid">
          <!-- Evade -->
          <div class="combat-stat-card">
            <div class="stat-icon evade-icon"><i class="fas fa-wind"></i></div>
            <div class="stat-content">
              <label>Evade</label>
              <div class="stat-value">{{default system.combat.evadeTotal 10}}</div>
              <div class="stat-formula">Agi + Def.Combat + (MR×2)</div>
            </div>
          </div>
          
          <!-- Armor -->
          <div class="combat-stat-card">
            <div class="stat-icon armor-icon"><i class="fas fa-shield-alt"></i></div>
            <div class="stat-content">
              <label>Armor</label>
              <div class="stat-value">{{default system.combat.armorTotal 0}}</div>
              <div class="stat-formula">Base + Shield + Passives</div>
            </div>
          </div>
          
          <!-- Speed -->
          <div class="combat-stat-card">
            <div class="stat-icon speed-icon"><i class="fas fa-running"></i></div>
            <div class="stat-content">
              <label>Speed</label>
              <div class="stat-value">{{default system.combat.speed 6}}m</div>
              <div class="stat-formula">Base Movement</div>
            </div>
          </div>
          
          <!-- Initiative Bonus -->
          <div class="combat-stat-card">
            <div class="stat-icon initiative-icon"><i class="fas fa-bolt"></i></div>
            <div class="stat-content">
              <label>Initiative</label>
              <div class="stat-value">+{{default system.combat.initiativeBonus 0}}</div>
              <div class="stat-formula">Combat Reflexes</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Saving Throws Section -->
      <div class="saving-throws-section">
        <h3><i class="fas fa-dice-d20"></i> Saving Throws</h3>
        
        <div class="saving-throws-grid">
          <!-- Might Save -->
          <div class="saving-throw-card">
            <div class="save-header">
              <i class="fas fa-dumbbell"></i>
              <label>Might</label>
            </div>
            <div class="save-value">{{default system.attributes.might.value 2}}</div>
            <button type="button" class="save-roll" data-attribute="might" title="Roll Might Save">
              <i class="fas fa-dice-d20"></i> Save
            </button>
          </div>
          
          <!-- Agility Save -->
          <div class="saving-throw-card">
            <div class="save-header">
              <i class="fas fa-running"></i>
              <label>Agility</label>
            </div>
            <div class="save-value">{{default system.attributes.agility.value 2}}</div>
            <button type="button" class="save-roll" data-attribute="agility" title="Roll Agility Save">
              <i class="fas fa-dice-d20"></i> Save
            </button>
          </div>
          
          <!-- Vitality Save -->
          <div class="saving-throw-card">
            <div class="save-header">
              <i class="fas fa-heart"></i>
              <label>Vitality</label>
            </div>
            <div class="save-value">{{default system.attributes.vitality.value 2}}</div>
            <button type="button" class="save-roll" data-attribute="vitality" title="Roll Vitality Save">
              <i class="fas fa-dice-d20"></i> Save
            </button>
          </div>
          
          <!-- Wits Save -->
          <div class="saving-throw-card">
            <div class="save-header">
              <i class="fas fa-brain"></i>
              <label>Wits</label>
            </div>
            <div class="save-value">{{default system.attributes.wits.value 2}}</div>
            <button type="button" class="save-roll" data-attribute="wits" title="Roll Wits Save">
              <i class="fas fa-dice-d20"></i> Save
            </button>
          </div>
          
          <!-- Intellect Save -->
          <div class="saving-throw-card">
            <div class="save-header">
              <i class="fas fa-book"></i>
              <label>Intellect</label>
            </div>
            <div class="save-value">{{default system.attributes.intellect.value 2}}</div>
            <button type="button" class="save-roll" data-attribute="intellect" title="Roll Intellect Save">
              <i class="fas fa-dice-d20"></i> Save
            </button>
          </div>
          
          <!-- Resolve Save -->
          <div class="saving-throw-card">
            <div class="save-header">
              <i class="fas fa-mountain"></i>
              <label>Resolve</label>
            </div>
            <div class="save-value">{{default system.attributes.resolve.value 2}}</div>
            <button type="button" class="save-roll" data-attribute="resolve" title="Roll Resolve Save">
              <i class="fas fa-dice-d20"></i> Save
            </button>
          </div>
          
          <!-- Influence Save -->
          <div class="saving-throw-card">
            <div class="save-header">
              <i class="fas fa-users"></i>
              <label>Influence</label>
            </div>
            <div class="save-value">{{default system.attributes.influence.value 2}}</div>
            <button type="button" class="save-roll" data-attribute="influence" title="Roll Influence Save">
              <i class="fas fa-dice-d20"></i> Save
            </button>
          </div>
        </div>
      </div>
      
    </div>
    
    <!-- SKILLS TAB -->
    <div class="tab skills" data-group="primary" data-tab="skills">
      
      <div class="skills-overview">
        <h3><i class="fas fa-cogs"></i> Skills Overview</h3>
        <p class="skills-description">
          Skills provide <strong>flat bonuses</strong> added after your roll. 
          <em>Formula: (Sum of kept dice) + Skill Bonus</em>
        </p>
        <div class="skill-points-display">
          <span class="label">Skill Points Available:</span>
          <span class="value">{{default system.skillPoints 16}}</span>
        </div>
      </div>
      
      {{#each skills}}
        {{#if @first}}
          <div class="skill-category">
            <h4 class="category-header"><i class="fas fa-running"></i> {{this.category}}</h4>
            <div class="skills-list">
        {{else}}
          {{#unless (eq this.category @root.skills.[subtract @index 1].category)}}
            </div></div>
            <div class="skill-category">
              <h4 class="category-header">
                {{#if (eq this.category "Knowledge & Craft")}}<i class="fas fa-book"></i>{{/if}}
                {{#if (eq this.category "Social")}}<i class="fas fa-comments"></i>{{/if}}
                {{#if (eq this.category "Survival")}}<i class="fas fa-tree"></i>{{/if}}
                {{#if (eq this.category "Martial")}}<i class="fas fa-sword"></i>{{/if}}
                {{this.category}}
              </h4>
              <div class="skills-list">
          {{/unless}}
        {{/if}}
        
        <div class="skill-item">
          <div class="skill-info">
            <label class="skill-name">{{this.name}}</label>
            <div class="skill-attributes">
              {{#each this.attributes}}
                <span class="attribute-tag">{{capitalize this}}</span>
              {{/each}}
            </div>
          </div>
          <div class="skill-controls">
            {{#if ../../editable}}
              <input type="number" name="system.skills.{{this.key}}" value="{{default this.value 0}}" min="0" max="32" class="skill-value" data-dtype="Number" />
            {{else}}
              <span class="skill-value-static">{{default this.value 0}}</span>
            {{/if}}
            <button type="button" class="skill-roll" data-skill="{{this.key}}" title="Roll {{this.name}}">
              <i class="fas fa-dice-d20"></i> Roll
            </button>
          </div>
        </div>
        
        {{#if @last}}
            </div>
          </div>
        {{/if}}
      {{/each}}
      
    </div>
    
    <!-- POWERS TAB -->
    <div class="tab powers" data-group="primary" data-tab="powers">
      <p style="padding: 20px; text-align: center; color: #666;">Powers tab - To be implemented in next step</p>
    </div>
    
    <!-- MAGIC TAB -->
    <div class="tab magic" data-group="primary" data-tab="magic">
      <p style="padding: 20px; text-align: center; color: #666;">Magic tab - To be implemented in next step</p>
    </div>
    
    <!-- EQUIPMENT TAB -->
    <div class="tab equipment" data-group="primary" data-tab="equipment">
      <p style="padding: 20px; text-align: center; color: #666;">Equipment tab - To be implemented in next step</p>
    </div>
    
    <!-- BIOGRAPHY TAB -->
    <div class="tab biography" data-group="primary" data-tab="biography">
      <p style="padding: 20px; text-align: center; color: #666;">Biography tab - To be implemented in next step</p>
    </div>
    
  </section>
</form>
