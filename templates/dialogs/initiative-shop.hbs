<div class="initiative-shop-dialog">
  <!-- HEADER -->
  <header class="shop-header flexrow">
    <div class="header-left flexrow">
      <img src="{{actor.img}}" alt="{{actor.name}}" class="actor-portrait">
      <div class="actor-info">
        <h2>{{actor.name}}</h2>
        <span class="mastery-badge">Rank {{masteryRank}}</span>
      </div>
    </div>
    <div class="header-right">
      <div class="remaining-pill">
        <div class="remaining-value">{{remainingInitiative}}</div>
        <div class="remaining-label">= Initiative Order</div>
      </div>
    </div>
  </header>

  <!-- BREAKDOWN -->
  <section class="breakdown-section">
    <div class="breakdown-grid">
      <div class="breakdown-card">
        <div class="breakdown-label">Base</div>
        <div class="breakdown-value">{{baseInitiative}}</div>
        <div class="breakdown-subtitle">Agility + Wits + Combat Reflexes</div>
      </div>
      <div class="breakdown-card">
        <div class="breakdown-label">Mastery Roll</div>
        <div class="breakdown-value">{{diceTotal}}</div>
        <div class="breakdown-subtitle">{{masteryRank}}d8 explode 8s</div>
      </div>
      <div class="breakdown-card">
        <div class="breakdown-label">Initiative Score</div>
        <div class="breakdown-value">{{totalInitiative}}</div>
        <div class="breakdown-subtitle">Base + Roll</div>
      </div>
    </div>
  </section>

  <!-- SHOP ITEMS -->
  <section class="shop-items">
    <!-- Extra Movement -->
    <div class="shop-item">
      <div class="item-header flexrow">
        <h3><i class="fas fa-running"></i> Extra Movement</h3>
        <span class="cost-badge">{{costs.movement}}</span>
      </div>
      <div class="item-controls flexrow">
        <button type="button" class="stepper-btn js-remove-movement" {{#unless purchases.extraMovement}}disabled{{/unless}}>
          <i class="fas fa-minus"></i>
        </button>
        <span class="purchase-count">{{purchases.extraMovement}}</span>
        <button type="button" class="stepper-btn js-buy-movement" {{#if (lt remainingInitiative costs.movement)}}disabled{{/if}}>
          <i class="fas fa-plus"></i>
        </button>
        <div class="item-details">
          <span class="subtotal">Spent: {{movementSpent}}</span>
          <span class="effect">+{{movementBonus}}m this round</span>
        </div>
      </div>
    </div>

    <!-- Initiative Swap -->
    <div class="shop-item">
      <div class="item-header flexrow">
        <h3><i class="fas fa-exchange-alt"></i> Initiative Swap</h3>
        <span class="cost-badge">{{costs.swap}}</span>
      </div>
      <div class="item-controls flexrow">
        <button type="button" class="toggle-btn js-buy-swap {{#if purchases.initiativeSwap}}purchased{{/if}}" 
                {{#if (lt remainingInitiative costs.swap)}}disabled{{/if}}>
          {{#if purchases.initiativeSwap}}
            <i class="fas fa-check"></i> Purchased
          {{else}}
            <i class="fas fa-shopping-cart"></i> Buy
          {{/if}}
        </button>
        <div class="item-details">
          <span class="subtitle">2 Raises • 1×/round</span>
        </div>
      </div>
    </div>

    <!-- Extra Attack -->
    <div class="shop-item">
      <div class="item-header flexrow">
        <h3><i class="fas fa-sword"></i> Extra Attack</h3>
        <span class="cost-badge">{{costs.extraAttack}}</span>
      </div>
      <div class="item-controls flexrow">
        <button type="button" class="toggle-btn js-buy-attack {{#if purchases.extraAttack}}purchased{{/if}}" 
                {{#if (lt remainingInitiative costs.extraAttack)}}disabled{{/if}}>
          {{#if purchases.extraAttack}}
            <i class="fas fa-check"></i> Purchased
          {{else}}
            <i class="fas fa-shopping-cart"></i> Buy
          {{/if}}
        </button>
        <div class="item-details">
          <span class="subtitle">1×/round</span>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="shop-footer flexrow">
    <button type="button" class="btn-secondary js-skip">
      <i class="fas fa-times"></i> Skip
    </button>
    <button type="button" class="btn-primary js-confirm">
      <i class="fas fa-check"></i> Confirm • Remaining {{remainingInitiative}}
    </button>
  </footer>
</div>
