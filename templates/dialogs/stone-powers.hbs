<div class="stone-powers-dialog">
  <div class="dialog-header">
    <h2>{{actor.name}}: Stone Powers</h2>
    <p>Activate stone powers using your attribute stone pools.</p>
  </div>

  <div class="stone-pools-display">
    <h3>Available Stones</h3>
    <div class="pools-grid">
      {{#each pools as |pool|}}
      <div class="pool-item">
        <span class="pool-name">{{pool.name}}</span>
        <span class="pool-value">{{pool.available}}/{{pool.max}}</span>
        {{#if pool.sustained}}
        <span class="pool-sustained">({{pool.sustained}} sustained)</span>
        {{/if}}
      </div>
      {{/each}}
    </div>
  </div>

  <div class="powers-list">
    {{#each powersByAttribute as |powers attr|}}
    {{#if powers.length}}
    <details class="power-group" {{#if @first}}open{{/if}}>
      <summary class="power-group-header">
        <h4>
          <i class="fas fa-chevron-right"></i>
          {{attr}} Powers
        </h4>
        <span class="power-count">({{powers.length}})</span>
      </summary>
      <div class="powers-grid">
        {{#each powers as |power|}}
        <div class="power-row">
          <div class="power-row-main">
            <div class="power-title">
              <strong class="power-name">
                {{power.name}}
                {{#if power.isGeneric}}
                <span class="power-tag is-generic">General</span>
                {{/if}}
              </strong>
              <button type="button" 
                      class="power-activate-btn js-activate-power" 
                      data-power-id="{{power.id}}"
                      data-attribute-key="{{#if (eq power.attribute 'generic')}}{{attr}}{{else}}{{power.attribute}}{{/if}}"
                      title="Activate (Cost: {{power.nextCost}})"
                      {{#unless @root.hasCombat}}disabled title="Only available during combat"{{/unless}}
                      {{#unless power.canAfford}}disabled title="Insufficient stones (Cost: {{power.nextCost}})"{{/unless}}>
                <i class="fas fa-gem"></i> {{power.nextCost}}
              </button>
            </div>
            <div class="power-desc">{{power.description}}</div>
          </div>
        </div>
        {{/each}}
      </div>
    </details>
    {{/if}}
    {{/each}}
  </div>

  <div class="dialog-footer">
    <button type="button" class="dialog-btn js-close">
      <i class="fas fa-times"></i> Close
    </button>
  </div>
</div>
